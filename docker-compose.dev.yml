services:
  portfolio:
    container_name: portfolio
    build:
      context: ./
      dockerfile: Dockerfile.dev
    restart: always
    volumes:
     - /opt/apps/portfolio:/app
    labels:
      - "traefik.enable=true"
      # HTTP Router (solo redirecci√≥n)
      - "traefik.http.routers.portfolio-http.rule=Host(`vargastomas.com`)"
      - "traefik.http.routers.portfolio-http.entrypoints=web"
      - "traefik.http.routers.portfolio-http.middlewares=https-redirect"
      # HTTPS Router (con seguridad)
      - "traefik.http.routers.portfolio-https.rule=Host(`vargastomas.com`)"
      - "traefik.http.routers.portfolio-https.entrypoints=websecure"
      - "traefik.http.routers.portfolio-https.middlewares=security-headers,stripprefix-portfolio"
      - "traefik.http.routers.portfolio-https.tls.certresolver=myresolver"
      # HTTPS Redirect Middleware
      - "traefik.http.middlewares.https-redirect.redirectscheme.scheme=https"
      - "traefik.http.middlewares.https-redirect.redirectscheme.permanent=true"
      # Security Headers Middleware
      - "traefik.http.middlewares.security-headers.headers.stsSeconds=63072000"
      - "traefik.http.middlewares.security-headers.headers.stsIncludeSubdomains=true"
      - "traefik.http.middlewares.security-headers.headers.stsPreload=true"
      - "traefik.http.middlewares.security-headers.headers.forceSTSHeader=true"
      - "traefik.http.middlewares.security-headers.headers.contentTypeNosniff=true"
      - "traefik.http.middlewares.security-headers.headers.referrerPolicy=strict-origin-when-cross-origin"
      - "traefik.http.middlewares.security-headers.headers.customFrameOptionsValue=SAMEORIGIN"
      - "traefik.http.middlewares.security-headers.headers.contentSecurityPolicy=default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data:; connect-src 'self'; object-src 'none'; frame-ancestors 'self'"
      # Strip Prefix Middleware
      - "traefik.http.middlewares.stripprefix-portfolio.stripprefix.prefixes=/"
      # Service
      - "traefik.http.services.portfolio.loadbalancer.server.port=80"
    networks:
      - net-nammu

networks:
  net-nammu:
    external: true
