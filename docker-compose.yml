services:
  portfolio:
    container_name: portfolio
    build:
      context: ./
      dockerfile: Dockerfile
    restart: always
    labels:
      # ============================================
      # Portfolio - vargastomas.com
      # ============================================
      - "traefik.enable=true"
      
      # HTTP Router -> Auto-redirect to HTTPS (forzado globalmente por entrypoint)
      - "traefik.http.routers.portfolio-http.rule=Host(`vargastomas.com`)"
      - "traefik.http.routers.portfolio-http.entrypoints=web"
      
      # HTTPS Router -> Middlewares aplicados GLOBALMENTE desde entrypoint
      - "traefik.http.routers.portfolio-https.rule=Host(`vargastomas.com`)"
      - "traefik.http.routers.portfolio-https.entrypoints=websecure"
      - "traefik.http.routers.portfolio-https.tls.certresolver=myresolver"
      - "traefik.http.routers.portfolio-https.middlewares=security-headers-strict@file"
    
      # Service configuration
      - "traefik.http.services.portfolio.loadbalancer.server.port=80"
    networks:
      - net-nammu
      
  portfolio_dev:
    container_name: portfolio_dev
    build:
      context: ./
      dockerfile: Dockerfile.dev
    restart: always
    volumes:
      # Montar el cÃ³digo fuente para hot reload
      - ./src:/app/src
      - ./public:/app/public
      - ./index.html:/app/index.html
      - ./vite.config.ts:/app/vite.config.ts
      - ./tailwind.config.ts:/app/tailwind.config.ts
      - ./tsconfig.json:/app/tsconfig.json
      - ./tsconfig.app.json:/app/tsconfig.app.json
      - ./tsconfig.node.json:/app/tsconfig.node.json
      # Evitar montar node_modules (usar los del contenedor)
      - /app/node_modules
    labels:
      # ============================================
      # Portfolio_dev - vargastomas.com
      # ============================================
      - "traefik.enable=true"
      
      # HTTP Router -> Auto-redirect to HTTPS (forzado globalmente por entrypoint)
      - "traefik.http.routers.portfolio_dev-http.rule=Host(`dev.vargastomas.com`)"
      - "traefik.http.routers.portfolio_dev-http.entrypoints=web"
      
      # HTTPS Router -> Middlewares aplicados GLOBALMENTE desde entrypoint
      - "traefik.http.routers.portfolio_dev-https.rule=Host(`dev.vargastomas.com`)"
      - "traefik.http.routers.portfolio_dev-https.entrypoints=websecure"
      - "traefik.http.routers.portfolio_dev-https.tls.certresolver=myresolver"
    
      # Service configuration
      - "traefik.http.services.portfolio_dev.loadbalancer.server.port=80"
    networks:
      - net-nammu

networks:
  net-nammu:
    external: true
